/**
  ******************************************************************************
  * @file           : morse_code.c
  * @author         : Hotakus (hotakus@foxmail.com)
  * @brief          : None
  * @date           : 2023/7/7
  ******************************************************************************
  */

#include <stdlib.h>
#include "morse_code.h"
#include "../algorithms/include/utilities.h"


const char *morse[55] = {".-", "-...", "-.-.", "-..", ".", "..-.", "--.", "....", "..", ".---", "-.-", ".-..", "--",
                         "-.", "---", ".--.", "--.-", ".-.", "...", "-", "..-", "...-", ".--", "-..-", "-.--", "--..",
                         "-----", ".----", "..---", "...--", "....-", ".....", "-....", "--...", "---..", "----.",
                         ".-.-.-", "--..--", "..--..", ".----.", "-.-.--", "-..-.", "-.--.", "-.--.-", ".-...",
                         "---...", "-.-.-.", "-...-", ".-.-.", "-....-", "..--.-", ".-..-.", "...-..-", ".--.-.",
                         "...---..."};
const char *ascii[55] = {"A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S",
                         "T", "U", "V", "W", "X", "Y", "Z", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", ".", ",",
                         "?", "'", "!", "/", "(", ")", "&", ":", ";", "=", "+", "-", "_", "\"", "$", "@", "SOS"};


char *str = "   sdafsdf asd       f d     dv    g    .g";
char *str2 = " ...---... -.-.--   - .... .   --.- ..- .. -.-. -.-   -... .-. --- .-- -.   ..-. --- -..-   .--- ..- -- .--. ...   --- ...- . .-.   - .... .   .-.. .- --.. -.--   -.. --- --. .-.-.-  ";
char *str3 = " -.. ..--.. -.-.-- -.--   .-.. --.- .--- -. --.. ...---... .-- ----- ----- --. --.. .-.   ----.   --... -.        ";
char *str4 = " ...-- .. -...- .---- -   -.--. --. .-... -.   -....- .-- -.--. --. ----- --- .....   ....- ...-- ...---... -....- ...---... .-...   -.--. ....- -.-.-. ---... --...   -..- -..-   -.--. ---   -- ..... ...---... .-. .-.-.- --.- .. -...-   ---..   .-.-.- ----- .....      ";
char *str5 = " ";


char *decode_morse(const char *morse_code) {
    int wn = 0;
    int size = 0;
    char **buf = str_split(morse_code, ' ', &wn);
    size = wn + 1;

    char *res = calloc(size, sizeof(char));
    char *pr = res;

    int off = 0;
    for (int i = 0; i < wn; ++i) {
        for (int k = 0; k < 55; ++k) {
            if (BA_STRCMP(morse[k], buf[i]) == 0) {
                int len = BA_STRLEN(ascii[k]);
                size += len - 1;

                res = realloc(res, sizeof(char) * size);
                pr = res + off; // 重分配偏移量

                if (len == 1) {
                    *pr++ = ascii[k][0];
                    off += 1;
                } else {
                    BA_STRCPY(pr, ascii[k]);
                    pr += len;
                    off += len;
                }
            }
        }

        if (buf[i][0] == ' ' && i == 0) continue;
        if (buf[i][0] == ' ' && i == wn - 1) continue;
        if (buf[i][0] == ' ') {
            *pr++ = ' ';
            off += 1;
            continue;
        }
    }

    *pr = '\0';
    str_split_free(buf, wn);
    return res;
}
